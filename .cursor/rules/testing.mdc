---
alwaysApply: true
description: í…ŒìŠ¤íŠ¸ ì‘ì„± ê·œì¹™ ë° ì „ëµ
tags: [testing, test, junit, mockito]
version: "1.0"
---

# í…ŒìŠ¤íŠ¸ ì „ëµ

## í†µí•© í…ŒìŠ¤íŠ¸ (Controller)

```java
@SpringBootTest
@AutoConfigureMockMvc
@TestExecutionListeners(
    value = DatabaseCleanupListener.class,
    mergeMode = TestExecutionListeners.MergeMode.MERGE_WITH_DEFAULTS  // âœ… í•„ìˆ˜
)
@DisplayName("ì‚¬ìš©ì í”„ë¡œí•„ ì»¨íŠ¸ë¡¤ëŸ¬ í†µí•© í…ŒìŠ¤íŠ¸")
class UserProfileControllerTest {

    @Autowired private MockMvc mockMvc;
    @Autowired private UserRepository userRepository;

    @Test
    @DisplayName("í”„ë¡œí•„ ì¡°íšŒ - ì„±ê³µ")
    void getProfile_Success() throws Exception {
        // Given: ì‹¤ì œ DBì— ë°ì´í„° ìƒì„±
        User user = userRepository.save(createUser());

        // When: API í˜¸ì¶œ (ì‹¤ì œ ì»¤ë°‹ ë°œìƒ)
        mockMvc.perform(get("/api/users/me/profile")
                .contentType(MediaType.APPLICATION_JSON))
            .andExpect(status().isOk())
            .andExpect(jsonPath("$.data.userUuid").value(user.getUuid().getValue()));

        // Then: DB ìƒíƒœ ê²€ì¦
        assertThat(userRepository.findByUuid(user.getUuid())).isPresent();
    }
    // DatabaseCleanupListenerê°€ ìë™ìœ¼ë¡œ í…Œì´ë¸” ì •ë¦¬
}
```

**ëŒ€ì•ˆ (JUnit 5 Extension - ê¸°ì¡´ ì½”ë“œ í˜¸í™˜):**
```java
@SpringBootTest
@ExtendWith(DatabaseCleanupExtension.class)  // âœ… ê°„ë‹¨í•˜ì§€ë§Œ Spring í†µí•©ì€ ì•½í•¨
class MyTest { }
```

## í•µì‹¬ ì›ì¹™

- âœ… **@SpringBootTest ì‚¬ìš©** (ì‹¤ì œ Spring ì»¨í…ìŠ¤íŠ¸)
- âœ… **ì‹¤ì œ Bean ì‚¬ìš©** (Service, Repository ëª¨ë‘ ì‹¤ì œ)
- âœ… **ì‹¤ì œ DB ì‚¬ìš©** (H2 í…ŒìŠ¤íŠ¸ DB)
- âœ… **ì™¸ë¶€ APIë§Œ ëª¨í‚¹** (ìš°ë¦¬ê°€ ì œì–´ ë¶ˆê°€ëŠ¥í•œ ê²ƒë§Œ)
- âœ… **DB ì •ë¦¬ í•„ìˆ˜**
  - **ê¶Œì¥**: `@TestExecutionListeners(value = DatabaseCleanupListener.class, mergeMode = MERGE_WITH_DEFAULTS)`
  - ëŒ€ì•ˆ: `@ExtendWith(DatabaseCleanupExtension.class)`
- âŒ **@Transactional ì‚¬ìš© ê¸ˆì§€** (ì‹¤ì œ ì»¤ë°‹ í…ŒìŠ¤íŠ¸ë¥¼ ìœ„í•´)

## DB ì •ë¦¬ ë°©ë²• ë¹„êµ

### DatabaseCleanupListener (â­ ê¶Œì¥)
- Spring TestExecutionListener ê¸°ë°˜
- Spring í…ŒìŠ¤íŠ¸ ì»¨í…ìŠ¤íŠ¸ì™€ ì™„ì „íˆ í†µí•©
- `TestContext`ë¥¼ í†µí•œ ì§ì ‘ì ì¸ ApplicationContext ì ‘ê·¼

```java
@TestExecutionListeners(
    value = DatabaseCleanupListener.class,
    mergeMode = TestExecutionListeners.MergeMode.MERGE_WITH_DEFAULTS  // âš ï¸ mergeMode í•„ìˆ˜!
)
```

### DatabaseCleanupExtension (ëŒ€ì•ˆ)
- JUnit 5 Extension ê¸°ë°˜
- ê°„ë‹¨í•œ ì‚¬ìš©ë²•
- ê¸°ì¡´ ì½”ë“œì™€ì˜ í˜¸í™˜ì„±

```java
@ExtendWith(DatabaseCleanupExtension.class)
```

**ì£¼ì˜:**
- ë‘ ë°©ì‹ ì¤‘ í•˜ë‚˜ë§Œ ì„ íƒ
- `@Transactional`ê³¼ í•¨ê»˜ ì‚¬ìš© ê¸ˆì§€

---

## ğŸ“ ì»¤ë°‹ ê·œì¹™

- **ì‹ ê·œ ì½”ë“œ = í…ŒìŠ¤íŠ¸ í•„ìˆ˜**
  - Controller ì¶”ê°€ â†’ í†µí•© í…ŒìŠ¤íŠ¸ ì¶”ê°€
  - Service ì¶”ê°€ â†’ ë‹¨ìœ„/í†µí•© í…ŒìŠ¤íŠ¸ ì¶”ê°€
  - Repository ì¶”ê°€ â†’ í…ŒìŠ¤íŠ¸ ì¶”ê°€

- **ì»¤ë°‹ ì „ í™•ì¸**
  ```bash
  ./gradlew test  # ëª¨ë“  í…ŒìŠ¤íŠ¸ í†µê³¼ í™•ì¸
  ```
