---
alwaysApply: true
description: Spring Config ê´€ë¦¬ ê·œì¹™
tags: [config, properties, spring, configuration]
version: "1.0"
---

# Spring Config ê´€ë¦¬ ê·œì¹™

## âš™ï¸ ConfigurationProperties íŒ¨í„´

### âœ… ì˜¬ë°”ë¥¸ ë°©ë²•

```java
@Getter
@ConfigurationProperties(prefix = "cors")
public class CorsProperties {

    private final List<String> allowedOrigins;
    private final boolean allowCredentials;
    private final long maxAge;

    /**
     * Constructor Binding (Spring Boot 3.x ìë™ ì ìš©)
     * ëª¨ë“  ê°’ì€ application.ymlì—ì„œ ì£¼ì…ë©ë‹ˆë‹¤.
     */
    public CorsProperties(
            List<String> allowedOrigins,
            boolean allowCredentials,
            long maxAge
    ) {
        this.allowedOrigins = allowedOrigins;
        this.allowCredentials = allowCredentials;
        this.maxAge = maxAge;
    }
}
```

### âŒ í”¼í•´ì•¼ í•  íŒ¨í„´

```java
// âŒ @Setter ì‚¬ìš© ê¸ˆì§€ (ëŸ°íƒ€ì„ ë³€ê²½ ê°€ëŠ¥)
@Setter
private List<String> allowedOrigins;

// âŒ ì½”ë“œì— ê¸°ë³¸ê°’ í•˜ë“œì½”ë”© ê¸ˆì§€
this.allowedOrigins = allowedOrigins != null ? allowedOrigins : 
    List.of("http://localhost:3000");

// âŒ @Component ì‚¬ìš© ê¸ˆì§€ (ìë™ ë¹ˆ ë“±ë¡ ë¶ˆí•„ìš”)
@Component
@ConfigurationProperties(prefix = "cors")
public class CorsProperties { }

// âŒ Boolean, Long ë˜í¼ íƒ€ì… ì‚¬ìš© ê¸ˆì§€
public CorsProperties(Boolean allowCredentials, Long maxAge) { }

// âœ… primitive íƒ€ì… ì‚¬ìš©
public CorsProperties(boolean allowCredentials, long maxAge) { }
```

---

## ğŸ“ application.yml ê´€ë¦¬

### ê¸°ë³¸ê°’ ê´€ë¦¬ ì›ì¹™

**âœ… ì˜¬ë°”ë¥¸ ë°©ë²•:**

```yaml
# application.yml
cors:
  allowed-origins: []  # í”„ë¡œíŒŒì¼ë³„ ì˜¤ë²„ë¼ì´ë“œ
  allowed-methods:
    - GET
    - POST
    - PUT
    - DELETE
  allow-credentials: true
  max-age: 3600  # 1ì‹œê°„ (ì´ˆ)

jwt:
  secret: ${AUTH_SECRET}  # í™˜ê²½ë³€ìˆ˜ í•„ìˆ˜
  expiration: ${JWT_EXPIRATION:86400000}  # ê¸°ë³¸ê°’ í¬í•¨
```

**âŒ í”¼í•´ì•¼ í•  íŒ¨í„´:**

```java
// âŒ ì½”ë“œì— ê¸°ë³¸ê°’ í•˜ë“œì½”ë”©
this.maxAge = maxAge != null ? maxAge : 3600L;

// âœ… application.ymlì—ì„œ ê´€ë¦¬
// cors.max-age: 3600
```

---

## ğŸ—ï¸ Config í´ë˜ìŠ¤ ì‘ì„± ê·œì¹™

### 1. í´ë˜ìŠ¤ êµ¬ì¡°

```java
/**
 * Spring Security ì„¤ì •
 * 
 * ê´€ë ¨ Properties: CorsProperties, JwtProperties
 * ì˜ì¡´ì„±: JwtAuthenticationFilter, NextAuthTokenFilter
 */
@Configuration
@EnableWebSecurity
@EnableMethodSecurity
@RequiredArgsConstructor
public class SecurityConfig {

    private final JwtAuthenticationFilter jwtAuthenticationFilter;
    private final CorsProperties corsProperties;

    @Bean
    public SecurityFilterChain filterChain(HttpSecurity http) {
        // ì„¤ì • ë¡œì§
        return http.build();
    }

    @Bean
    public CorsConfigurationSource corsConfigurationSource() {
        CorsConfiguration configuration = new CorsConfiguration();
        
        // Propertiesì—ì„œ ê°’ ì£¼ì…
        configuration.setAllowedOrigins(corsProperties.getAllowedOrigins());
        configuration.setAllowedMethods(corsProperties.getAllowedMethods());
        configuration.setAllowCredentials(corsProperties.isAllowCredentials());
        
        return source;
    }
}
```

### 2. JavaDoc í•„ìˆ˜

```java
/**
 * CORS ì„¤ì •ì„ application.ymlì—ì„œ ê´€ë¦¬í•˜ê¸° ìœ„í•œ Properties í´ë˜ìŠ¤
 * 
 * ëª¨ë“  ê¸°ë³¸ê°’ì€ application.ymlì—ì„œ ê´€ë¦¬ë©ë‹ˆë‹¤.
 * Immutableí•˜ê²Œ ê´€ë¦¬ë˜ë©°, ì• í”Œë¦¬ì¼€ì´ì…˜ ì‹œì‘ ì‹œ í•œ ë²ˆë§Œ ë°”ì¸ë”©ë©ë‹ˆë‹¤.
 * 
 * @see SecurityConfig
 */
@Getter
@ConfigurationProperties(prefix = "cors")
public class CorsProperties {
    // ...
}
```

---

## ğŸ“‚ Config í´ë˜ìŠ¤ ë°°ì¹˜ ì›ì¹™

| ì„¤ì • íƒ€ì… | ìœ„ì¹˜ | ì˜ˆì‹œ |
|-----------|------|------|
| Spring í”„ë ˆì„ì›Œí¬ ì„¤ì • | `config/` | SecurityConfig, WebMvcConfig |
| Properties í´ë˜ìŠ¤ | `config/` | CorsProperties, JwtProperties |
| Infrastructure êµ¬í˜„ | `infra/security/` | JwtAuthenticationFilter |
| DB ì„¤ì • | `config/` | QueryDslConfig |

**íŒ¨í‚¤ì§€ êµ¬ì¡°:**

```
com/bifos/accountbook/
â”œâ”€â”€ config/                    # âœ… Spring ì„¤ì •
â”‚   â”œâ”€â”€ AsyncConfig.java
â”‚   â”œâ”€â”€ CorsProperties.java
â”‚   â”œâ”€â”€ OpenApiConfig.java
â”‚   â”œâ”€â”€ QueryDslConfig.java
â”‚   â”œâ”€â”€ SecurityConfig.java
â”‚   â””â”€â”€ WebMvcConfig.java
â”‚
â””â”€â”€ infra/                     # âœ… Infrastructure êµ¬í˜„
    â”œâ”€â”€ persistence/           # DB ë ˆì´ì–´
    â”œâ”€â”€ security/              # JWT, í•„í„° êµ¬í˜„ì²´
    â”œâ”€â”€ filter/                # HTTP í•„í„°
    â””â”€â”€ exception/             # ì˜ˆì™¸ ì²˜ë¦¬
```

---

## ğŸ” í™˜ê²½ë³€ìˆ˜ ê´€ë¦¬

### ë¯¼ê°í•œ ì •ë³´ëŠ” í™˜ê²½ë³€ìˆ˜ë¡œ

```yaml
# âœ… ì˜¬ë°”ë¥¸ ë°©ë²•
jwt:
  secret: ${AUTH_SECRET}  # í•„ìˆ˜ í™˜ê²½ë³€ìˆ˜
  expiration: ${JWT_EXPIRATION:86400000}  # ì„ íƒì  (ê¸°ë³¸ê°’)

# âŒ ì ˆëŒ€ ê¸ˆì§€
jwt:
  secret: "hardcoded-secret-key-12345"  # ìœ„í—˜!
```

### í”„ë¡œíŒŒì¼ë³„ ì˜¤ë²„ë¼ì´ë“œ

```yaml
# application.yml (ê³µí†µ)
cors:
  allowed-origins: []
  max-age: 3600

# application-local.yml
cors:
  allowed-origins:
    - http://localhost:3000

# application-prod.yml
cors:
  allowed-origins:
    - https://your-domain.vercel.app
```

---

## âœ… ì²´í¬ë¦¬ìŠ¤íŠ¸

Config í´ë˜ìŠ¤ ì‘ì„± ì‹œ ë‹¤ìŒì„ í™•ì¸í•˜ì„¸ìš”:

- [ ] `@ConfigurationProperties` ì‚¬ìš©
- [ ] `@Getter`ë§Œ ì‚¬ìš© (`@Setter` ê¸ˆì§€)
- [ ] ëª¨ë“  í•„ë“œë¥¼ `final`ë¡œ ì„ ì–¸
- [ ] Constructor Binding íŒ¨í„´ ì‚¬ìš©
- [ ] ê¸°ë³¸ê°’ì€ application.ymlì— ì •ì˜
- [ ] JavaDoc ì‘ì„±
- [ ] primitive íƒ€ì… ì‚¬ìš© (Boolean â†’ boolean)
- [ ] í™˜ê²½ë³€ìˆ˜ + ê¸°ë³¸ê°’ íŒ¨í„´: `${ENV:default}`
- [ ] ë¯¼ê°í•œ ì •ë³´ëŠ” í™˜ê²½ë³€ìˆ˜ë¡œë§Œ
- [ ] `config/` íŒ¨í‚¤ì§€ì— ë°°ì¹˜

---

## ğŸ¯ í•µì‹¬ ì›ì¹™

1. **ë¶ˆë³€ì„±**: PropertiesëŠ” ë¶ˆë³€ ê°ì²´ (`final` + Constructor)
2. **ì¤‘ì•™í™”**: ëª¨ë“  ê¸°ë³¸ê°’ì€ application.ymlì—ì„œ ê´€ë¦¬
3. **í™˜ê²½ë³€ìˆ˜**: ë¯¼ê°í•œ ì •ë³´ëŠ” ì½”ë“œì— í¬í•¨ ê¸ˆì§€
4. **íƒ€ì… ì•ˆì „ì„±**: primitive íƒ€ì… ì‚¬ìš©
5. **ë¶„ë¦¬**: Config(ì„¤ì •) vs Infra(êµ¬í˜„ì²´) ëª…í™•íˆ êµ¬ë¶„
