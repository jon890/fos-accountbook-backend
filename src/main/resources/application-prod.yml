# ============================================
# 프로덕션 환경 설정 (Railway)
# ============================================
# Railway에서 SPRING_PROFILES_ACTIVE=prod 환경변수 설정 필수

spring:
  # Railway MySQL 설정 (조합된 URL 사용)
  # Railway Variables 탭에서 다음 변수 설정:
  #   SPRING_DATASOURCE_URL=jdbc:mysql://${{MySQL.MYSQLHOST}}:${{MySQL.MYSQLPORT}}/${{MySQL.MYSQLDATABASE}}?useSSL=false&serverTimezone=Asia/Seoul&characterEncoding=UTF-8&allowPublicKeyRetrieval=true
  #   SPRING_DATASOURCE_USERNAME=${{MySQL.MYSQLUSER}}
  #   SPRING_DATASOURCE_PASSWORD=${{MySQL.MYSQLPASSWORD}}
  datasource:
    url: ${SPRING_DATASOURCE_URL}
    username: ${SPRING_DATASOURCE_USERNAME}
    password: ${SPRING_DATASOURCE_PASSWORD}
    driver-class-name: com.mysql.cj.jdbc.Driver

    # HikariCP 커넥션 풀 최적화
    hikari:
      maximum-pool-size: 10 # 최대 커넥션 수
      minimum-idle: 2 # 최소 유휴 커넥션
      connection-timeout: 30000 # 30초
      idle-timeout: 600000 # 10분
      max-lifetime: 1800000 # 30분
      connection-test-query: SELECT 1 # 연결 테스트

  # JPA 프로덕션 설정
  jpa:
    hibernate:
      ddl-auto: validate # Flyway가 스키마 관리 (변경 금지)
    properties:
      hibernate:
        format_sql: false # SQL 포맷팅 비활성화
        show_sql: false # SQL 로깅 비활성화

  # Flyway 프로덕션 설정
  flyway:
    enabled: true
    clean-disabled: true # 프로덕션에서 clean 금지 (데이터 보호)

# Swagger 프로덕션 설정 (환경변수로 제어)
springdoc:
  api-docs:
    enabled: ${SWAGGER_ENABLED:false} # 기본 비활성화
  swagger-ui:
    enabled: ${SWAGGER_ENABLED:false} # 기본 비활성화

# Actuator 프로덕션 설정 (보안을 위해 최소화)
management:
  endpoints:
    web:
      exposure:
        # 프로덕션에서는 health만 노출
        include: health
  endpoint:
    health:
      # 헬스 체크는 기본 정보만 표시 (보안)
      show-details: when-authorized
      show-components: when-authorized

# CORS 설정 (프로덕션 환경) - allowed-origins만 오버라이드
cors:
  allowed-origins:
    - https://fos-accountbook.vercel.app
