# ============================================
# 프로덕션 환경 설정 (Railway)
# ============================================
# Railway에서 SPRING_PROFILES_ACTIVE=prod 환경변수 설정 필수

spring:
  # Railway MySQL 설정 (조합된 URL 사용)
  # Railway Variables 탭에서 다음 변수 설정:
  #   SPRING_DATASOURCE_URL=jdbc:mysql://${{MySQL.MYSQLHOST}}:${{MySQL.MYSQLPORT}}/${{MySQL.MYSQLDATABASE}}?useSSL=false&serverTimezone=Asia/Seoul&characterEncoding=UTF-8&allowPublicKeyRetrieval=true
  #   SPRING_DATASOURCE_USERNAME=${{MySQL.MYSQLUSER}}
  #   SPRING_DATASOURCE_PASSWORD=${{MySQL.MYSQLPASSWORD}}
  datasource:
    url: ${SPRING_DATASOURCE_URL}
    username: ${SPRING_DATASOURCE_USERNAME}
    password: ${SPRING_DATASOURCE_PASSWORD}
    driver-class-name: com.mysql.cj.jdbc.Driver
    
    # HikariCP 커넥션 풀 최적화
    hikari:
      maximum-pool-size: 10       # 최대 커넥션 수
      minimum-idle: 2             # 최소 유휴 커넥션
      connection-timeout: 30000   # 30초
      idle-timeout: 600000        # 10분
      max-lifetime: 1800000       # 30분
      connection-test-query: SELECT 1  # 연결 테스트
  
  # JPA 프로덕션 설정
  jpa:
    hibernate:
      ddl-auto: validate  # Flyway가 스키마 관리 (변경 금지)
    properties:
      hibernate:
        format_sql: false  # SQL 포맷팅 비활성화
        show_sql: false    # SQL 로깅 비활성화
  
  # Flyway 프로덕션 설정
  flyway:
    enabled: true
    clean-disabled: true  # 프로덕션에서 clean 금지 (데이터 보호)

# Swagger 프로덕션 설정 (환경변수로 제어)
springdoc:
  api-docs:
    enabled: ${SWAGGER_ENABLED:false}  # 기본 비활성화
  swagger-ui:
    enabled: ${SWAGGER_ENABLED:false}  # 기본 비활성화

# 로깅: logback-spring.xml의 'prod' 프로파일 사용
# - Console 로깅만 (stdout/stderr)
# - Railway가 자동으로 로그 수집 및 표시
# - 파일 로깅 비활성화
# - INFO 레벨

# Railway 환경변수 (필수):
# - DATABASE_URL: Railway MySQL URL
# - DB_USERNAME: Railway MySQL 사용자
# - DB_PASSWORD: Railway MySQL 비밀번호
# - AUTH_SECRET: JWT + NextAuth 공통 비밀키 (프론트엔드와 동일한 값)
# - JWT_EXPIRATION: Access Token 만료 시간 (선택, 기본 24시간)
# - JWT_REFRESH_EXPIRATION: Refresh Token 만료 시간 (선택, 기본 7일)
# - SWAGGER_ENABLED: Swagger UI 활성화 여부 (선택, 기본 false)
# - PORT: Railway가 자동 주입
